"use strict"
const WEIGHTS_LENGTH=10
var ngTagCloud=angular.module("ngTagCloud",[])
ngTagCloud.directive("ngTagCloud",["$timeout","$log",function(e,t){return{restrict:"EA",scope:{cloudWidth:"=?",cloudHeight:"=?",cloudOverflow:"=?",cloudData:"=",cloudClick:"=",weights:"=",delayedMode:"=?",onRendered:"&"},template:"<div id='ng-tag-cloud' class='ng-tag-cloud'></div>",link:function(o,a,d){if(""===o.cloudData||void 0===o.cloudData)return void t.debug("ng-tag-cloud: No data passed. Please pass tags data as json. <ng-tag-cloud cloud-data='tagsJSON'></ng-tag-cloud\nFor more info see here: https://github.com/zeeshanhyder/angular-tag-cloud")
if(void 0!==o.weights&&10!==o.weights.length)return void t.error("ng-tag-cloud: weights length should be exactly 10")
o.$watchCollection("[cloudData]",function(){e(function(){r(),h()},50)})
var i={width:o.cloudWidth?o.cloudWidth:"300",height:o.cloudHeight?o.cloudHeight:"300",delayedMode:void 0!==o.delayedMode?o.delayedMode:o.cloudData.length>50}
i.afterCloudRender=function(){o.onRendered()}
var n=angular.element(a)[0],l=(n.getAttribute("id")||Math.floor(1e6*Math.random()).toString(36),[]),r=function(){l=o.cloudData,n.style.width=i.width+"px",n.style.height=i.height+"px"
var e={width:n.offsetWidth,height:n.offsetHeight,center:{x:i.width/2,y:i.height/2},delayedMode:i.delayedMode,shape:!1,encodeURI:!0,removeOverflowing:!o.cloudOverflow}
o.weights&&(i.weights=o.weights),i=angular.extend(e,i||{})}
r(),"static"!==n.style.position&&""!==n.style.position||(n.style.position="relative")
var h=function(){a.empty()
for(var t=function(e,t){var o=0
for(o=0;o<t.length;o++)if(function(e,t){return Math.abs(2*e.offsetLeft+e.offsetWidth-2*t.offsetLeft-t.offsetWidth)<e.offsetWidth+t.offsetWidth&&Math.abs(2*e.offsetTop+e.offsetHeight-2*t.offsetTop-t.offsetHeight)<e.offsetHeight+t.offsetHeight}(e,t[o]))return!0
return!1},d=0;d<l.length;d++)l[d].weight=parseFloat(l[d].weight,10)
l.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0})
var r="rectangular"===i.shape?18:2,h=[],f=i.width/i.height,c=function(e,a){var d,c=6.28*Math.random(),g=0,s=0,u=0,p=5
l[0].weight>l[l.length-1].weight&&(p=Math.round((a.weight-l[l.length-1].weight)/(l[0].weight-l[l.length-1].weight)*9)+1),d=document.createElement("span"),d.className="w"+p
var w=document.createTextNode(a.text)
if(void 0!==a.link&&""!==a.link){if("string"==typeof a.link)var v=a.link
i.encodeURI&&(v=encodeURI(v).replace(/'/g,"%27"))
var y=document.createElement("a")
y.href=v,y.appendChild(w),d.appendChild(y)}else d.appendChild(w)
var m=angular.element
o.cloudClick&&(m(d).click({text:a.text},o.cloudClick),m(d).addClass("cloud-word")),n.appendChild(d),i.weights&&(d.style.fontSize=i.weights[p-1])
var M=d.offsetWidth,C=d.offsetHeight,x=i.center.x-M/2,W=i.center.y-C/2,k=d.style
for(k.position="absolute",k.left=x+"px",k.top=W+"px";t(d,h);){if("rectangular"===i.shape)switch(s++,s*r>(1+Math.floor(u/2))*r*(u%4%2==0?1:f)&&(s=0,u++),u%4){case 1:x+=r*f+2*Math.random()
break
case 2:W-=r+2*Math.random()
break
case 3:x-=r*f+2*Math.random()
break
case 0:W+=r+2*Math.random()}else g+=r,c+=(e%2==0?1:-1)*r,x=i.center.x-M/2+g*Math.cos(c)*f,W=i.center.y+g*Math.sin(c)-C/2
k.left=x+"px",k.top=W+"px"}if(i.removeOverflowing&&(x<0||W<0||x+M>i.width||W+C>i.height))return void d.remove()
h.push(d),"function"==typeof a.afterWordRender&&a.afterWordRender.call(d)},g=function(t){if(t=t||0,n.offsetWidth<=0&&n.offsetHeight<=0)return void e(function(){g(t)},10)
t<l.length?(c(t,l[t]),e(function(){g(t+1)},10)):0!==t&&"function"==typeof i.afterCloudRender&&i.afterCloudRender.call(n)}
i.delayedMode?g():(l.forEach(function(e,t){c(t,e)}),"function"==typeof i.afterCloudRender&&i.afterCloudRender.call(n))}},replace:!0}}])
